{
    "rules": {
        // ===== ข้อมูลผู้ใช้ (moved to bottom to avoid duplication) =====
        // ===== ผู้ใช้รอ Approve =====
        "pendingUsers": {
            ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')",
            ".write": "auth != null",
            "$uid": {
                ".read": "auth != null && auth.uid == $uid"
            }
        },
        // ===== เครื่องจักร =====
        "machines": {
            ".read": "auth != null",
            ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')",
            "$machineId": {
                ".validate": "newData.hasChildren(['name']) && newData.child('name').isString()"
            }
        },
        // ===== Parts =====
        "parts": {
            ".read": "auth != null",
            ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')",
            ".indexOn": [
                "machineId",
                "name"
            ],
            "$partId": {
                ".validate": "newData.hasChildren(['name']) && newData.child('name').isString()"
            }
        },
        // ===== Maintenance Records =====
        "maintenance_records": {
            ".read": "auth != null",
            ".write": "auth != null && root.child('users').child(auth.uid).child('isApproved').val() == true && root.child('users').child(auth.uid).child('role').val() != 'viewer'",
            ".indexOn": [
                "date",
                "machineId",
                "pmPlanId",
                "partId",
                "type"
            ],
            "$recordId": {
                ".validate": "newData.hasChildren(['machineId', 'date'])"
            }
        },
        // ===== PM Plans =====
        "pm_plans": {
            ".read": "auth != null",
            ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')",
            ".indexOn": [
                "machineId",
                "nextDueDate"
            ]
        },
        // ===== Schedules =====
        "schedules": {
            ".read": "auth != null",
            ".write": "auth != null && root.child('users').child(auth.uid).child('isApproved').val() == true && root.child('users').child(auth.uid).child('role').val() != 'viewer'",
            "$scheduleId": {
                ".validate": "newData.hasChildren(['machineId', 'nextDue'])"
            }
        },
        // ===== Spare Parts =====
        "spare_parts": {
            ".read": "auth != null",
            ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')",
            ".indexOn": [
                "name"
            ]
        },
        // ===== Stock Transactions =====
        "stock_transactions": {
            ".read": "auth != null",
            ".write": "auth != null && root.child('users').child(auth.uid).child('isApproved').val() == true",
            ".indexOn": [
                "partId"
            ]
        },
        // ===== Image Hashes =====
        "image_hashes": {
            ".read": "auth != null",
            ".write": "auth != null"
        },
        // ===== Sensor Readings =====
        "sensor_readings": {
            ".read": "auth != null",
            ".write": "auth != null && root.child('users').child(auth.uid).child('isApproved').val() == true",
            ".indexOn": [
                "machineId",
                "timestamp"
            ]
        },
        // ===== System Stats (For Usage History) =====
        "system_stats": {
            ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')",
            "usage_history": {
                ".read": "auth != null",
                ".write": "auth != null"
            }
        },
        // ===== Usage Logs (New) =====
        "usage_logs": {
            ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')",
            "$date": {
                ".read": "auth != null",
                ".write": "auth != null"
            }
        },
        // ===== Performance Evaluations =====
        "performance_evaluations": {
            ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')",
            ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')",
            "$technicianId": {
                ".read": "auth != null && (auth.uid == $technicianId || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')"
            }
        },
        // ===== Data Translations (Auto-Translate) =====
        "data_translations": {
            ".read": "auth != null",
            ".write": "auth != null"
        },
        // ===== Audit Logs (Admin Only) =====
        "audit_logs": {
            ".read": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
            ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')"
        },
        // ===== System Settings (Public read for maintenance mode check) =====
        "system_settings": {
            ".read": "auth != null",
            ".write": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor')"
        },
        // ===== Users =====
        "users": {
            "$uid": {
                ".read": "auth != null && (auth.uid == $uid || root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor' || root.child('users').child(auth.uid).child('role').val() == 'technician')",
                ".write": "auth != null && (auth.uid == $uid || root.child('users').child(auth.uid).child('role').val() == 'admin')"
            },
            ".read": "auth != null && (root.child('users').child(auth.uid).child('role').val() == 'admin' || root.child('users').child(auth.uid).child('role').val() == 'supervisor' || root.child('users').child(auth.uid).child('role').val() == 'technician')"
        }
    }
}